<!DOCTYPE html>

<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Basic Drag&Drop</title>
    <link rel="stylesheet" href="../css/playground_dragdrop.css" type="text/css">
</head>

<body>
This is a basic example to get started with drag&drop and web programming in general.

<h2> How to use this website</h2>
<ul>
    <li>You can drag & drop paragraphs between the two shelves below.</li>
</ul>


<div id="shelf1" class="dnd-shelf">
    <h2> Shelf 1</h2>
    <p id="item1" class="dnd-item" draggable="true"> C'mon! Drag me!</p>
    <p id="item2" class="dnd-item" draggable="true"> Mee too!</p>
    <p id="item3" class="dnd-item" draggable="true"> Here!!</p>
</div>

<div id="shelf2" class="dnd-shelf">
    <h2> Shelf 2</h2>
    <p id="item4" class="dnd-item" draggable="true"> Drag&Drop rocks!</p>
</div>

<div id="shelf3" class="dnd-shelf" >
    <h2> Shelf 3 - no drops allowed here </h2>
    <p id="item5" class="no-dnd-item" draggable="false"> I am the one and only!</p>
</div>


<script>
    /* notes: setting dropEffect influences the appearance of the cursor in chrome, however, it dropEffect is still 'none' in the ondrop event.

      */

    // Returns true iff value is in list
    function contains(list, value) {
        for( var i = 0; i < list.length; ++i ) {
            if(list[i] === value) return true;
        }
        return false;
    }

    function doDragStart(event) {
        var dropData = this.id;
        var transfer = event.dataTransfer;
        transfer.setData('text/id', dropData);
        transfer.effectAllowed = 'copyMove';
    }

    // checks if drop is acceptable on target
    function doDragEnter(event) {
        if (contains( event.dataTransfer.types, 'text/id')) {
            console.log('doDragEnter');
            event.dataTransfer.dropEffect = 'copy';
            event.preventDefault();
        }
    }

    //
    function doDragOver(event) {
        console.log('doDragOver');
        event.dataTransfer.dropEffect = 'copy';
        event.preventDefault();
    }

    // called on target element
    function doDrop(event) {
        console.log('doDrop')
        console.log("effect " + event.dataTransfer.dropEffect);

        var dropData = event.dataTransfer.getData("text/id");
        console.log("data = " + dropData);

        // move source item after target item
        var sourceNode = document.getElementById(dropData);
        this.parentNode.insertBefore(sourceNode,this);
    }

    // called on source element
    function doDragEnd(event) {
        var dropeffect = event.dataTransfer.dropEffect;

        switch (dropeffect) {
            case 'move':
                // delete yourself?
                console.log("moved");
                break;
            case 'copy':
                // like default
                console.log("copied");
            default:
                // nothing to do
                console.log("default");
        }
    }

    // setting up event handlers
    // advantage: 'this' references the element that is the origin of the event
    // the event object is automatically passed as the first parameter to the event handlers

    var dndItems = document.getElementsByClassName('dnd-item');

    for (var i=0; i<dndItems.length; ++i) {
        dndItems[i].addEventListener('dragstart', doDragStart);
        dndItems[i].addEventListener('dragenter', doDragEnter);
        dndItems[i].addEventListener('dragover', doDragOver);
        dndItems[i].addEventListener('drop', doDrop);
        dndItems[i].addEventListener('dragend', doDragEnd);
    };

    var item5 = document.getElementById("item5");
    item5.addEventListener('dragenter', function(event) {
        console.log('item5: not allowed');
        event.dataTransfer.effectAllowed = 'none';
            }
    );

</script>


</body>
</html>